/*	javascript-markdown-quiz - 0.0.1
 *
 *	(c) 2021 Aelora Web Services, LLC
 *	https://compsci.rocks
 */

var mdq={path:{bootstrap5:"https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css",marked:"https://cdnjs.cloudflare.com/ajax/libs/marked/3.0.7/marked.min.js",mathjax:"",mermaid:""},loadedQuestions:[],config:{},init:async function(t){this.config={count:5,parent:"",lang:{correct:"Correct",incorrect:"Incorrect",check:"Check",help:"Help",true:"True",false:"False"},questions:[],theme:"",css:!0,...t};for(let t=this.config.questions.length-1;0<t;t--){var e=Math.floor(Math.random()*(t+1)),a=this.config.questions[t];this.config.questions[t]=this.config.questions[e],this.config.questions[e]=a}await this.loadFiles(),await this.loadScripts(this.getScripts(),this.buildPage)},loadScripts:function(e,a){if(e.length<1)a();else{let t=e.shift();var i;t.endsWith(".js")?((i=document.createElement("script")).src=t,i.async=!1,i.addEventListener("load",()=>{this.loadScripts(e,a)}),document.head.appendChild(i)):t.endsWith(".css")&&((i=document.createElement("link")).rel="stylesheet",i.type="text/css",i.href=t,i.media="all",i.addEventListener("load",()=>{this.loadScripts(e,a)}),document.head.appendChild(i))}},getScripts:function(){return scripts=[],scripts.push(this.path.marked),"bootstrap5"==mdq.config.theme&&scripts.push(this.path.bootstrap5),scripts},buildPage:function(){var t;mdq.config.css&&((t=document.createElement("style")).setAttribute("type","text/css"),t.appendChild(document.createTextNode(mdqCSS.cssContents)),document.head.appendChild(t));var e=document.createElement("div");e.setAttribute("class","mdq-wrap "+("bootstrap5"==mdq.config.theme?"container":"")),mdq.loadedQuestions.forEach(t=>{e.appendChild(mdq.questionElement(t))}),(""==mdq.config.parent?document.body:document.getElementById(mdq.config.parent)).appendChild(e)},questionElement:function(a){var e=document.createElement("div");e.setAttribute("class","mdq-question"),e.setAttribute("id",a.hash);let t=document.createElement("div");t.setAttribute("class","md-question-body"),t.innerHTML=mdq.formatQuestion(a.markdown),e.appendChild(t);let i="";if(mdq.isMultipleChoice(a)){let t=mdqQuestions.mcHTML(a);t.addEventListener("click",t=>{mdqQuestions.highlightMC(t)}),e.appendChild(t),i="MC"}let n=document.createElement("div");n.setAttribute("class","mdq-buttons");let s=document.createElement("button");if(s.setAttribute("data-type",i),s.setAttribute("data-hash",a.hash),s.setAttribute("disabled",!0),s.addEventListener("click",t=>{mdqQuestions.checkQuestion(t.currentTarget.getAttribute("data-hash"))}),s.innerHTML=mdq.config.lang.check+"...",n.appendChild(s),void 0!==a.sections.explanation){let t=document.createElement("button");t.setAttribute("disabled",!0),t.setAttribute("data-help",1),t.setAttribute("data-hash",a.hash),t.addEventListener("click",t=>{let e=document.querySelector('div.mdq-explanation[data-hash="'+a.hash+'"]');e&&(e.style.display="block")}),t.innerHTML=this.config.lang.help+"...",n.appendChild(t)}if(e.appendChild(n),void 0!==a.sections.explanation){let t=document.createElement("div");t.setAttribute("class","mdq-explanation"),t.setAttribute("data-hash",a.hash),t.style.display="none",t.innerHTML=marked(a.sections.explanation),e.appendChild(t)}return e},formatQuestion:function(t){return marked(t)},loadFiles:async function(t){for(const a of this.config.questions){let t=await fetch(a);var e;if(200<=t.status&&t.status<400&&(e=await t.text(),this.loadedQuestions.push(this.fileInfo(e))),this.loadedQuestions.length>=this.config.count)break}},fileInfo:function(t){t=t.trim();let e={};e.rawContent=t,e.hash=Math.random().toString(36).slice(-10),e.frontMatter={};let a=t.match(/^---\s*?(.*?)---/s);a&&(e.frontMatter=this.parseFrontMatter(a[1].trim()));let i=(t=t.replace(/^---\s*?(.*?)---/s,"").trim()).split(/---[\t ]*?([A-Za-z ]+)/g);e.markdown=i.shift().trim(),e.sections={};for(let t=0;t<i.length-1;t+=2)e.sections[this.toCamelCase(i[t].trim())]=i[t+1].trim();return e},parseFrontMatter:function(t){let a={},e=t.split(/\n\r?/);return e.forEach(t=>{let e=(t=t.trim()).split(/\s*?:\s*?/);2==e.length&&(a[this.toCamelCase(e[0].trim())]=e[1].trim())}),a},getParts:function(t){return{frontMatter:{title:"",type:"",answer:""},body:"",explanation:""}},toCamelCase:function(t){return t.replace(/\s(.)/g,function(t){return t.toUpperCase()}).replace(/\s/g,"").replace(/^(.)/,function(t){return t.toLowerCase()})},isMultipleChoice:function(t){let e=t.frontMatter.type??"";return e=e.trim(),!("mc"!=e.toLowerCase()&&!e.match(/^mult.*?/i))||""==e&&void 0!==t.sections.answers},shuffle:function(e){for(let t=e.length-1;0<t;t--){var a=Math.floor(Math.random()*(t+1)),i=e[t];e[t]=e[a],e[a]=i}return e}},mdqCSS={cssContents:`div.mdq-wrap .mdq-question{margin-bottom:48px;padding-top:16px;border-top:1px solid silver}div.mdq-wrap .mdq-question:first-child{border-top:none}div.mdq-wrap .mdq-mc-grid{display:grid;grid-template-columns:min-content 1fr;cursor:pointer;padding-top:16px}div.mdq-wrap .mdq-mc-grid>div{padding-right:16px}div.mdq-wrap .mdq-mc-grid>div.sel{background:#eee}div.mdq-wrap .mdq-mc-grid>div.correct{background:#ccffcc}div.mdq-wrap .mdq-mc-grid>div.incorrect{background:#ffc2b3}div.mdq-wrap .mdq-buttons button{margin-right:16px;margin-top:16px}div.mdq-wrap .mdq-explanation{margin-top:16px}
`},mdqQuestions={mcHTML:function(n){let t=n.sections.answers.split(/---[\t ]*\r?\n/),s=n.frontMatter.answer??1;if(s.match(/^[A-Za-z]{1}$/))s="ABCDEFGHIJKLMNOPQRSTUVWXYZ".indexOf(s.toUpperCase())+1;else if(!s.match(/^\d+?$/))return void console.error("Could not determine correct answer for question");let r=document.createElement("div");r.setAttribute("class","mdq-mc-grid"),r.setAttribute("data-hash",n.hash);let d=[],o=1;t.forEach(t=>{let e=document.createElement("div");e.setAttribute("data-row",o),e.setAttribute("data-hash",n.hash),e.setAttribute("data-col",0);let a=document.createElement("input");a.type="radio",a.name="ans-"+n.hash,a.setAttribute("data-row",o),a.setAttribute("data-hash",n.hash),a.setAttribute("data-c",o==s?1:0),e.appendChild(a),r.appendChild(e);let i=document.createElement("div");i.setAttribute("data-row",o),i.setAttribute("data-hash",n.hash),i.innerHTML=marked(t),d.push([e,i]),o++});let e=n.frontMatter.shuffle;return void 0!==e&&!e.match(/^t.*/i)&&1!=e||(d=mdq.shuffle(d)),d.forEach(t=>{r.appendChild(t[0]),r.appendChild(t[1])}),r},highlightMC:function(t){let e=t.target.closest("[data-row]");var a=e.getAttribute("data-hash"),t=e.getAttribute("data-row");document.querySelector('[data-row="'+t+'"][data-hash="'+a+'"] > input').checked=!0;let i=document.querySelectorAll('.mdq-mc-grid[data-hash="'+a+'"] > div');i.forEach(t=>{t.classList.remove("sel","correct","incorrect")});let n=document.querySelectorAll('.mdq-mc-grid > div[data-row="'+t+'"][data-hash="'+a+'"]');n.forEach(t=>{t.classList.add("sel")}),document.querySelector('button[data-hash="'+a+'"]').disabled=!1},checkQuestion:function(t){var e=mdqQuestions.getQuestion(t);if(!1!==e)if(mdq.isMultipleChoice(e)){mdqQuestions.checkMCQuestion(e);let t=document.querySelector('button[data-help][data-hash="'+e.hash+'"]');t&&(t.disabled=!1)}else console.error("Only MC checking is implemented for now");else console.error("Question "+t+" not found")},checkMCQuestion:function(t){let e=document.querySelectorAll('div.mdq-mc-grid[data-hash="'+t.hash+'"] > div');e.forEach(t=>{t.classList.remove("sel","correct","incorrect")});let a=document.querySelector("input[name=ans-"+t.hash+"]:checked"),i=1==a.getAttribute("data-c"),n=document.querySelectorAll('div.mdq-mc-grid[data-hash="'+a.getAttribute("data-hash")+'"] > div[data-row="'+a.getAttribute("data-row")+'"][data-hash="'+a.getAttribute("data-hash")+'"]');n.forEach(t=>{t.classList.add(i?"correct":"incorrect")})},getQuestion:function(t){for(const e of mdq.loadedQuestions)if(e.hash==t)return e;return!1}};
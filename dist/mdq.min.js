/*	javascript-markdown-quiz - 0.5
 *
 *	(c) 2021 Aelora Web Services, LLC
 *	https://compsci.rocks/scripts/
 */

var mermaid_config={startOnLoad:!1};class MDQ{loadedQuestions=[];allQuestions=[];currentGroups=[];paths={bootstrap5:"https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css",marked:"https://cdnjs.cloudflare.com/ajax/libs/marked/3.0.7/marked.min.js",mathjax:"https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.0/es5/tex-svg-full.min.js",mermaid:"https://cdnjs.cloudflare.com/ajax/libs/mermaid/8.13.2/mermaid.min.js",prismJS:"https://cdnjs.cloudflare.com/ajax/libs/prism/1.25.0/prism.min.js",prismAutoload:"https://cdnjs.cloudflare.com/ajax/libs/prism/1.25.0/plugins/autoloader/prism-autoloader.min.js",prismCSS:"https://cdnjs.cloudflare.com/ajax/libs/prism/1.25.0/themes/prism.min.css"};parentElement=null;hash=null;constructor(t){if(this.config={autoStart:!0,count:5,parent:"",lang:{correct:"Correct",incorrect:"Incorrect",check:"Check",help:"Help",true:"True",false:"False",reload:"Reload"},questions:[],theme:"",css:!0,syntaxHighlight:!0,credit:!0,reload:!0,stripRaw:!0,loadScripts:!0,...t},this.loadedQuestions=[],this.allQuestions=[],""==this.config.parent)this.parentElement=document.body;else if("string"==typeof this.config.parent){if(this.parentElement=document.querySelector(this.config.parent),null===this.parentElement)return void console.error("Could not find parent element "+this.config.parent)}else{if(!(this.config.parent instanceof HTMLElement))throw new Error("Invalid parent element.");this.parentElement=this.config.parent}this.hash=Math.random().toString(36).slice(-10),this.config.autoStart&&this.init()}async init(){var t;if(this.allQuestions=[],Array.isArray(this.config.questions)?this.allQuestions=this.config.questions:"object"==typeof this.config.questions&&(t=Object.keys(this.config.questions),this.currentGroups.length<1&&(this.currentGroups=t),this.currentGroups.forEach(t=>{t in this.config.questions?this.allQuestions=this.allQuestions.concat(this.config.questions[t]):console.error("Cannot find key "+t+" in questions")})),this.allQuestions.length<1)console.error("No questions found in config");else{for(let t=this.allQuestions.length-1;0<t;t--){var e=Math.floor(Math.random()*(t+1)),s=this.allQuestions[t];this.allQuestions[t]=this.allQuestions[e],this.allQuestions[e]=s}window.Prism=window.Prism||{},Prism.manual=!0,await this.loadFiles(),this.loadScripts(this.getScripts(),this.buildPage.bind(this))}}async loadFiles(){this.loadedQuestions=[];for(const s of this.allQuestions){let t=await fetch(s);var e;if(200<=t.status&&t.status<400&&(e=await t.text(),this.loadedQuestions.push(new MDQQuestion(e,s,this.config))),this.loadedQuestions.length>=this.config.count)break}}getScripts(){if(!this.config.loadScripts)return[];let e=[];e.push(this.paths.marked),"bootstrap5"==this.config.theme&&e.push(this.paths.bootstrap5);let s=!1,r=!1,i=!1;return this.loadedQuestions.forEach(t=>{!s&&t.needsMathJax()&&(e.push(this.paths.mathjax),s=!0),!r&&t.needsMermaid()&&(e.push(this.paths.mermaid),r=!0),!i&&t.needsPrism()&&(e.push(this.paths.prismCSS),e.push(this.paths.prismJS),e.push(this.paths.prismAutoload),i=!0)}),e}getParts(t){return{frontMatter:{title:"",type:"",answer:""},body:"",explanation:""}}loadScripts(e,s){if(e.length<1)s();else{let t=e.shift();var r;this.styleLoaded(t)||this.scriptLoaded(t)?this.loadScripts(e,s):t.endsWith(".js")?((r=document.createElement("script")).src=t,r.async=!1,r.addEventListener("load",()=>{this.loadScripts(e,s)}),document.head.appendChild(r)):t.endsWith(".css")&&((r=document.createElement("link")).rel="stylesheet",r.type="text/css",r.href=t,r.media="all",r.addEventListener("load",()=>{this.loadScripts(e,s)}),document.head.appendChild(r))}}styleLoaded(t){return!!document.querySelector('style[href="'+t+'"]')}scriptLoaded(t){return!!document.querySelector('script[src="'+t+'"]')}buildPage(){!!!document.querySelector("style#mdq-css")&&this.config.css&&((t=document.createElement("style")).setAttribute("type","text/css"),t.setAttribute("id","mdq-css"),t.appendChild(document.createTextNode(this.CSSContents())),document.head.appendChild(t));var t,s=document.createElement("div");let e=document.createElement("a");if(e.setAttribute("name","mdq-top-"+this.hash),s.appendChild(e),s.setAttribute("class","mdq-wrap "+("bootstrap5"==this.config.theme?"container":"")),this.hasGroups()&&s.appendChild(this._elementButtons()),this.loadedQuestions.forEach(t=>{s.appendChild(t.element(this.config.theme))}),this.config.reload){let t=document.createElement("div");t.classList.add("mdq-reload");let e=document.createElement("button");this.isBootstrap()&&e.classList.add("btn","btn-primary"),e.innerHTML=mdq.config.lang.reload,e.addEventListener("click",t=>{this.init(this.config),location.hash="#mdq-top-"+this.hash}),t.appendChild(e),s.appendChild(t)}this.config.credit&&((t=document.createElement("div")).classList.add("mdq-credit"),t.innerHTML='Quiz script by <a href="https://compsci.rocks/scripts/" target="_blank">CompSci.rocks</a>',s.appendChild(t)),this.parentElement.innerHTML="",this.parentElement.appendChild(s),this.parentElement.querySelectorAll('input[data-type="fib"]').forEach(t=>{t.addEventListener("keydown",t=>{var e=t.target.getAttribute("data-hash");t.target.classList.remove("correct","incorrect"),this.parentElement.querySelector('button[data-hash="'+e+'"]').disabled=!1})}),this.parentElement.querySelectorAll('select[data-type="sel"]').forEach(t=>{t.selectedIndex=-1,t.addEventListener("change",t=>{var e=t.target.getAttribute("data-hash");t.target.classList.remove("correct","incorrect"),this.parentElement.querySelector('button[data-hash="'+e+'"]').disabled=!1})});let r=this.parentElement.querySelectorAll("pre code.language-mermaid");r.forEach(t=>{t.parentElement;let e=document.createElement("div");e.classList.add("mermaid"),e.innerHTML=t.innerHTML,t.parentElement.replaceChild(e,t)}),mermaid.init({},this.parentElement.querySelectorAll("div.mermaid")),"undefined"!=typeof MathJax&&MathJax.typeset&&MathJax.typeset(),Prism.highlightAll&&Prism.highlightAll(this.parentElement)}_elementButtons(){let i=document.createElement("div");return i.classList.add("mdq-question-groups"),this.isBootstrap()?(i.classList.add("btn-group","mdq-button-group"),this.groupList().forEach(t=>{let e=document.createElement("button");e.classList.add("btn","mdq-button"),this.currentGroups.includes(t)?(e.classList.add("btn-primary"),e.setAttribute("data-sel",1)):(e.classList.add("btn-outline-primary"),e.setAttribute("data-sel",0)),e.innerText=t,e.setAttribute("data-group",t),e.addEventListener("click",t=>{let e=t.target;if(MDQ.isTruthy(e.getAttribute("data-sel"))){if(!(1<e.parentElement.querySelectorAll('button[data-sel="1"]').length))return;t=this.currentGroups.indexOf(e.getAttribute("data-group"));0<=t&&this.currentGroups.splice(t,1)}else this.currentGroups.push(e.getAttribute("data-group"));this.init(this.config)}),i.appendChild(e)})):this.groupList().forEach(t=>{let e=document.createElement("label"),s=document.createElement("input");s.setAttribute("type","checkbox"),s.setAttribute("data-group",t),s.checked=mdq.currentGroups.includes(t),s.addEventListener("change",function(t){if(this.checked)mdq.currentGroups.push(this.getAttribute("data-group"));else{if(this.parentElement.parentElement.querySelectorAll('input[type="checkbox"]:checked').length<1)return void(this.checked=!0);var e=mdq.currentGroups.indexOf(this.getAttribute("data-group"));0<=e&&mdq.currentGroups.splice(e,1)}mdq.init(mdq.config)});let r=document.createElement("span");r.innerText=t,e.appendChild(s),e.appendChild(r),i.appendChild(e)}),i}static toCamelCase(t){return t.replace(/\s(.)/g,function(t){return t.toUpperCase()}).replace(/\s/g,"").replace(/^(.)/,function(t){return t.toLowerCase()})}static isTruthy(t){return 1==(t="string"==typeof(t|=!1)?t.toLowerCase():t)||"true"==t||"1"==t}static decodeEntities(t){let e=document.createElement("textarea");return e.innerHTML=t,e.value}CSSContents(){return`div.mdq-wrap .mdq-question-groups{margin-top:16px;margin-bottom:8px}div.mdq-wrap .mdq-question-groups label{padding-right:16px;margin-bottom:8px}div.mdq-wrap .mdq-question-groups input[type="checkbox"]{margin-right:8px}div.mdq-wrap .mdq-question{margin-bottom:48px;padding-top:16px;border-top:1px solid silver}div.mdq-wrap .mdq-question:first-child{border-top:none}div.mdq-wrap .mdq-question input.correct,div.mdq-wrap .mdq-question select.correct{background-color:#ccffcc !important}div.mdq-wrap .mdq-question input.incorrect,div.mdq-wrap .mdq-question select.incorrect{background-color:#ffc2b3 !important}div.mdq-wrap .mdq-mc-grid{display:grid;grid-template-columns:min-content 1fr;cursor:pointer;padding-top:16px}div.mdq-wrap .mdq-mc-grid>div{padding-right:16px}div.mdq-wrap .mdq-mc-grid>div.sel{background:#eee}div.mdq-wrap .mdq-mc-grid>div.correct{background:#ccffcc}div.mdq-wrap .mdq-mc-grid>div.incorrect{background:#ffc2b3}div.mdq-wrap .mdq-buttons button{margin-right:16px;margin-top:16px}div.mdq-wrap .mdq-explanation{margin-top:16px}div.mdq-wrap .form-select,div.mdq-wrap .form-control{width:auto;display:inline !important}div.mdq-wrap .mdq-tf-result{margin-left:16px}div.mdq-wrap .mdq-tf-result.correct{color:green}div.mdq-wrap .mdq-tf-result.incorrect{color:red}div.mdq-wrap .mdq-credit{padding-top:32px;padding-bottom:16px}div.mdq-wrap .mdq-credit a{text-decoration:none}div.mdq-wrap .mdq-credit a:hover{text-decoration:underline}div.mdq-wrap .mdq-reload{margin-top:16px;margin-bottom:16px}
`}groupCount(){return this.currentGroups.length}isBootstrap(){return"bootstrap5"==this.config.theme}static shuffle(e){for(let t=e.length-1;0<t;t--){var s=Math.floor(Math.random()*(t+1)),r=e[t];e[t]=e[s],e[s]=r}return e}hasGroups(){return"object"==typeof this.config.questions&&!Array.isArray(this.config.questions)}groupList(){return this.hasGroups()?Object.keys(this.config.questions):[]}}class MDQQuestion{rawContent="";properties={};url="";config={};constructor(t,e,s){this.rawContent=t,this.url=e,this.config=s,t=(t=t.replace(/^\s*{%\s*raw\s*%}\s*/,"")).replace(/\s*{%\s*endraw\s*%}\s*$/,""),this.hash=Math.random().toString(36).slice(-10);s=t.match(/^\s*?---\s*?(.*?)---/s);this.properties=s?this.parseFrontMatter(s[1]):{};let r=(t=t.replace(/^\s*?---\s*?(.*?)---/s,"").trim()).split(/---[\t ]*?([A-Za-z ]+)/g);this.markdown=r.shift().trim(),this.sections={};for(let t=0;t<r.length-1;t+=2)this.sections[MDQ.toCamelCase(r[t].trim())]=r[t+1].trim()}formatted(){let t=marked(this.markdown);return this.isFIB()&&(t=this._formatFIB(t)),t}element(){let e=document.createElement("div");e.setAttribute("data-hash",this.hash);let t=document.createElement("div");t.classList.add("mdq-question"),t.setAttribute("data-hash",this.hash),t.innerHTML=this.formatted(),e.appendChild(t);let s="";if(this.isMC())e.appendChild(this._elementMC()),s="MC";else if(this.isTF())e.appendChild(this._elementTF()),s="TF";else{if(!this.isFIB())throw new Error("Unknown question type");s="FIB"}let r=document.createElement("div");r.classList.add("mdq-buttons");let i=document.createElement("button");if(this.useBootstrap()&&i.classList.add("btn","btn-primary"),i.setAttribute("data-hash",this.hash),i.setAttribute("data-type",s),i.setAttribute("disabled",!0),i.addEventListener("click",t=>{this.checkAnswer()}),i.innerHTML=this.config.lang.check+"...",r.appendChild(i),void 0!==this.sections.explanation){let t=document.createElement("button");t.setAttribute("disabled",!0),t.setAttribute("data-help",1),t.setAttribute("data-hash",this.hash),this.useBootstrap()&&t.classList.add("btn","btn-secondary"),t.addEventListener("click",t=>{let e=document.querySelector('div.mdq-explanation[data-hash="'+this.hash+'"]');e&&(e.style.display="block")}),t.innerHTML=this.config.lang.help+"...",r.appendChild(t)}if(e.appendChild(r),void 0!==this.sections.explanation){let t=document.createElement("div");t.setAttribute("class","mdq-explanation"),t.setAttribute("data-hash",this.hash),t.style.display="none",t.innerHTML=marked(this.sections.explanation),e.appendChild(t)}return e}_setupFIB(t){console.info(t);var e=t.querySelectorAll('input[type="text"][data-type="fib"]');console.info(e),console.info(t.querySelectorAll('div[data-hash="'+this.hash+'"]'))}_elementMC(){let t=this.sections.answers.split(/---[\t ]*\r?\n/),i=this.getProperty("answer")??"1";if(i.match(/^[A-Za-z]{1}$/))i="ABCDEFGHIJKLMNOPQRSTUVWXYZ".indexOf(i.toUpperCase())+1;else if(!i.match(/^\d+?$/))return void console.error("Could not determine correct answer for question");let a=document.createElement("div");a.setAttribute("data-hash",this.hash);let e=document.createElement("div");e.classList.add("mdq-mc-grid"),e.setAttribute("data-hash",this.hash);let n=[],o=1;t.forEach(t=>{let e=document.createElement("div");e.setAttribute("data-row",o),e.setAttribute("data-hash",this.hash),e.setAttribute("data-col",0);let s=document.createElement("input");s.type="radio",s.name="ans-"+this.hash,s.setAttribute("data-row",o),s.setAttribute("data-hash",this.hash),s.setAttribute("data-c",o==i?1:0),e.appendChild(s),a.appendChild(e);let r=document.createElement("div");r.setAttribute("data-row",o),r.setAttribute("data-hash",this.hash),r.innerHTML=marked(t),n.push([e,r]),o++});let s=this.getProperty("shuffle");return void 0!==s&&!s.match(/^t.*/i)&&1!=s||(n=MDQ.shuffle(n)),n.forEach(t=>{e.appendChild(t[0]),e.appendChild(t[1])}),e.addEventListener("click",t=>{let e=t.target.closest("[data-row]");var s=e.getAttribute("data-hash"),t=e.getAttribute("data-row");let r=document.querySelector('[data-row="'+t+'"][data-hash="'+s+'"] > input');r.checked=!0;let i=document.querySelectorAll('.mdq-mc-grid[data-hash="'+s+'"] > div');i.forEach(t=>{t.classList.remove("sel","correct","incorrect")});let a=document.querySelectorAll('.mdq-mc-grid > div[data-row="'+t+'"][data-hash="'+s+'"]');a.forEach(t=>{t.classList.add("sel")}),document.querySelector('button[data-hash="'+s+'"]').disabled=!1}),a.appendChild(e),a}_elementTF(){let t=this.getProperty("answer")??"t";t=t.match(/^f.*/i)?"F":"T";let e=document.createElement("div"),s=document.createElement("select");s.setAttribute("data-hash",this.hash),s.setAttribute("data-c",t),this.useBootstrap()&&s.classList.add("form-select");let r=document.createElement("option");r.innerHTML=this.config.lang.true,r.value="T",s.appendChild(r);let i=document.createElement("option");i.innerHTML=this.config.lang.false,i.value="F",s.appendChild(i),s.value=-1,s.addEventListener("change",t=>{document.querySelector('button[data-hash="'+this.hash+'"][data-type="TF"]').disabled=!1,document.querySelector('span[data-result][data-hash="'+this.hash+'"]').innerHTML=""}),e.appendChild(s);let a=document.createElement("span");return a.classList.add("mdq-tf-result"),a.setAttribute("data-hash",this.hash),a.setAttribute("data-result",1),a.innerHTML="",e.appendChild(a),e}_parseFIBOptions(t){let e=t.split(/\s*?,\s*?/),s={};return e.forEach(t=>{let e=t.split(/\s*?:\s*?/);void 0!==e[0]&&void 0!==e[1]&&(s[MDQ.toCamelCase(e[0].trim())]=e[1].trim())}),s}_formatFIB(t){return t=(t=t.replace(/___\((.*?)\)\[(.*?)\]/g,(t,e,s)=>{s=this._parseFIBOptions(s);let r=document.createElement("input");return r.setAttribute("data-type","fib"),r.setAttribute("data-hash",this.hash),r.setAttribute("data-c",e),this.useBootstrap()&&r.classList.add("form-control"),void 0!==s.width&&(r.style.width=s.width),r.setAttribute("data-opts",JSON.stringify(s)),r.outerHTML})).replace(/___{(.*?)}\[(.*?)]/g,(t,e,s)=>{s=this._parseFIBOptions(s);let r=document.createElement("select");r.setAttribute("data-hash",this.hash),r.setAttribute("data-type","sel"),this.useBootstrap()&&r.classList.add("form-select");let i=e.split(/\s*?\|\s*?/),a=[];return i.forEach(t=>{var e=!!t.match(/^\+:/);t=t.replace(/^(\+|\-):/,"");let s=document.createElement("option");s.setAttribute("data-c",e?1:0),s.value=t,s.innerHTML=t,a.push(s)}),s.shuffle&&("1"==s.shuffle||s.shuffle.match(/^(t|y)/i))&&(a=mdq.shuffle(a)),a.forEach(t=>{r.appendChild(t)}),r.outerHTML})}checkAnswer(){this.isMC()?this._checkAnswerMC():this.isTF()?this._checkAnswerTF():this.isFIB()&&this._checkAnswerFIB();let t=document.querySelector('button[data-help][data-hash="'+this.hash+'"]');t&&(t.disabled=!1)}_checkAnswerMC(){let t=document.querySelectorAll('div.mdq-mc-grid[data-hash="'+this.hash+'"] > div');t.forEach(t=>{t.classList.remove("sel","correct","incorrect")});let e=document.querySelector("input[name=ans-"+this.hash+"]:checked"),s=1==e.getAttribute("data-c"),r=document.querySelectorAll('div.mdq-mc-grid[data-hash="'+e.getAttribute("data-hash")+'"] > div[data-row="'+e.getAttribute("data-row")+'"][data-hash="'+e.getAttribute("data-hash")+'"]');r.forEach(t=>{t.classList.add(s?"correct":"incorrect")})}_checkAnswerTF(){let t=document.querySelector('span[data-result][data-hash="'+this.hash+'"]');t.classList.remove("correct","incorrect"),t.innerHTML="";let e=document.querySelector('select[data-hash="'+this.hash+'"]');e.value==e.getAttribute("data-c")?(t.classList.add("correct"),t.innerHTML=this.config.lang.correct):(t.classList.add("incorrect"),t.innerHTML=this.config.lang.incorrect)}_checkAnswerFIB(){let t=document.querySelector('div.mdq-question[data-hash="'+this.hash+'"]');t.querySelectorAll('input[data-type="fib"]').forEach(t=>{t.classList.remove("correct","incorrect");let r=MDQ.decodeEntities(t.value.trim());if(""!=r){var i=JSON.parse(t.getAttribute("data-opts"));let e=!1,s=t.getAttribute("data-c");if(MDQ.isTruthy(i.contains))e=MDQ.isTruthy(i.caseSensitive)?-1<r.toLowerCase().indexOf(s.toLowerCase()):-1<r.indexOf(s);else if(MDQ.isTruthy(i.regex)){let t="";var a=s.replace(/^\//,"").match(/\/([gimy]*)$/);a&&(t=a[1]),regexString=s.replace(/^\//,"").replace(/\/[gimy]*$/,"");a=new RegExp(regexString,t);e=!!r.match(a)}else e=MDQ.isTruthy(i.caseSensitive)?r==s:r.toLowerCase()==s.toLowerCase();t.classList.add(e?"correct":"incorrect")}}),t.querySelectorAll('select[data-type="sel"]').forEach(e=>{e.classList.remove("correct","incorrect");var s=e.selectedIndex;if(0<=s){let t=e.options[s];e.classList.add(1==t.getAttribute("data-c")?"correct":"incorrect")}})}isMC(){return"mc"==this.getProperty("type","mc").toLowerCase()}isTF(){return"tf"==this.getProperty("type","").toLowerCase()}isFIB(){return"fib"==this.getProperty("type","").toLowerCase()}useBootstrap(){return"bootstrap5"==this.config.theme}getProperty(t,e){return this.properties[t]??e}parseFrontMatter(t){let s={},e=t.split(/\n\r?/);return e.forEach(t=>{let e=(t=t.trim()).split(/\s*?:\s*?/);2==e.length&&(s[MDQ.toCamelCase(e[0].trim())]=e[1].trim())}),void 0===s.answer&&void 0!==s.ans&&(s.answer=s.ans),s}needsMathJax(){return!(!this.rawContent.match(/\$\$(.*?)\$\$/s)&&!this.rawContent.match(/\\\(.*?\)\\/s))}needsMermaid(){return!!this.rawContent.match(/```mermaid/s)}needsPrism(){let t=this.rawContent.match(/```([A-Za-z0-9]+)/gs),e=!1;return!!t&&(t.forEach(t=>{"```mermaid"!=t&&(e=!0)}),e)}}
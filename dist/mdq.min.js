/*	javascript-markdown-quiz - 0.4
 *
 *	(c) 2021 Aelora Web Services, LLC
 *	https://compsci.rocks/scripts/
 */

var mermaid_config={startOnLoad:!1},mdq={path:{bootstrap5:"https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css",marked:"https://cdnjs.cloudflare.com/ajax/libs/marked/3.0.7/marked.min.js",mathjax:"https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.0/es5/tex-svg-full.min.js",mermaid:"https://cdnjs.cloudflare.com/ajax/libs/mermaid/8.13.2/mermaid.min.js",prismJS:"https://cdnjs.cloudflare.com/ajax/libs/prism/1.25.0/prism.min.js",prismAutoload:"https://cdnjs.cloudflare.com/ajax/libs/prism/1.25.0/plugins/autoloader/prism-autoloader.min.js",prismCSS:"https://cdnjs.cloudflare.com/ajax/libs/prism/1.25.0/themes/prism.min.css"},loadedQuestions:[],allQuestions:[],currentGroups:[],config:{},init:async function(t){if(this.config={count:5,parent:"",lang:{correct:"Correct",incorrect:"Incorrect",check:"Check",help:"Help",true:"True",false:"False",reload:"Reload"},questions:[],theme:"",css:!0,syntaxHighlight:!0,credit:!0,reload:!0,stripRaw:!0,...t},this.loadedQuestions=[],this.allQuestions=[],Array.isArray(this.config.questions)?this.allQuestions=this.config.questions:"object"==typeof this.config.questions&&(t=Object.keys(this.config.questions),this.currentGroups.length<1&&(this.currentGroups=t),this.currentGroups.forEach(t=>{t in this.config.questions?this.allQuestions=this.allQuestions.concat(this.config.questions[t]):console.error("Cannot find key "+t+" in questions")})),this.allQuestions.length<1)console.error("No questions found in config");else{for(let t=this.allQuestions.length-1;0<t;t--){var e=Math.floor(Math.random()*(t+1)),r=this.allQuestions[t];this.allQuestions[t]=this.allQuestions[e],this.allQuestions[e]=r}window.Prism=window.Prism||{},Prism.manual=!0,await this.loadFiles(),await this.loadScripts(this.getScripts(),this.buildPage)}},loadScripts:function(e,r){if(e.length<1)r();else{let t=e.shift();var a;mdq.styleLoaded(t)||mdq.scriptLoaded(t)?r():t.endsWith(".js")?((a=document.createElement("script")).src=t,a.async=!1,a.addEventListener("load",()=>{this.loadScripts(e,r)}),document.head.appendChild(a)):t.endsWith(".css")&&((a=document.createElement("link")).rel="stylesheet",a.type="text/css",a.href=t,a.media="all",a.addEventListener("load",()=>{this.loadScripts(e,r)}),document.head.appendChild(a))}},styleLoaded:function(t){return!!document.querySelector('style[href="'+t+'"]')},scriptLoaded:function(t){return!!document.querySelector('script[src="'+t+'"]')},getScripts:function(){scripts=[],scripts.push(this.path.marked),"bootstrap5"==mdq.config.theme&&scripts.push(this.path.bootstrap5);let e=!1,r=!1,a=!1;return mdq.loadedQuestions.forEach(t=>{!e&&mdqQuestions.needsMathJax(t)&&(scripts.push(this.path.mathjax),e=!0),!r&&mdqQuestions.needsMermaid(t)&&(scripts.push(this.path.mermaid),r=!0),!a&&mdqQuestions.needsPrism(t)&&(scripts.push(this.path.prismCSS),scripts.push(this.path.prismJS),scripts.push(this.path.prismAutoload),a=!0)}),scripts},buildPage:function(){!!!document.querySelector("style#mdq-css")&&mdq.config.css&&((t=document.createElement("style")).setAttribute("type","text/css"),t.setAttribute("id","mdq-css"),t.appendChild(document.createTextNode(mdqCSS.cssContents)),document.head.appendChild(t));var t,r=document.createElement("div");let e=document.createElement("a");if(e.setAttribute("name","mdq-top"),r.appendChild(e),r.setAttribute("class","mdq-wrap "+("bootstrap5"==mdq.config.theme?"container":"")),mdq.hasGroups()){let s=document.createElement("div");s.classList.add("mdq-question-groups"),mdq.isBootstrap()?(s.classList.add("mdq-button-group"),s.classList.add("btn-group"),mdq.groupList().forEach(t=>{let e=document.createElement("button");e.classList.add("btn"),e.classList.add("mdq-button"),mdq.currentGroups.includes(t)?(e.classList.add("btn-primary"),e.setAttribute("data-sel",1)):(e.classList.add("btn-outline-primary"),e.setAttribute("data-sel",0)),e.innerText=t,e.setAttribute("data-group",t),e.addEventListener("click",function(t){if(mdq.isTruthy(this.getAttribute("data-sel"))){if(!(1<this.parentElement.querySelectorAll('button[data-sel="1"]').length))return;var e=mdq.currentGroups.indexOf(this.getAttribute("data-group"));0<=e&&mdq.currentGroups.splice(e,1)}else mdq.currentGroups.push(this.getAttribute("data-group"));mdq.init(mdq.config)}),s.appendChild(e)})):mdq.groupList().forEach(t=>{let e=document.createElement("label"),r=document.createElement("input");r.setAttribute("type","checkbox"),r.setAttribute("data-group",t),r.checked=mdq.currentGroups.includes(t),r.addEventListener("change",function(t){if(this.checked)mdq.currentGroups.push(this.getAttribute("data-group"));else{if(this.parentElement.parentElement.querySelectorAll('input[type="checkbox"]:checked').length<1)return void(this.checked=!0);var e=mdq.currentGroups.indexOf(this.getAttribute("data-group"));0<=e&&mdq.currentGroups.splice(e,1)}mdq.init(mdq.config)});let a=document.createElement("span");a.innerText=t,e.appendChild(r),e.appendChild(a),s.appendChild(e)}),r.appendChild(s)}if(mdq.loadedQuestions.forEach(t=>{r.appendChild(mdq.questionElement(t))}),mdq.config.reload){let t=document.createElement("div");t.classList.add("mdq-reload");let e=document.createElement("button");mdq.isBootstrap()&&e.classList.add("btn","btn-primary"),e.innerHTML=mdq.config.lang.reload,e.addEventListener("click",t=>{let e=mdq.parentElement(),r=document.createElement("a");r.setAttribute("name","mdq-top"),e.innerHTML="",e.appendChild(r),location.hash="#mdq-top",mdq.init(mdq.config)}),t.appendChild(e),r.appendChild(t)}mdq.config.credit&&((t=document.createElement("div")).classList.add("mdq-credit"),t.innerHTML='Quiz script by <a href="https://compsci.rocks/scripts/" target="_blank">CompSci.rocks</a>',r.appendChild(t));let a=document.querySelectorAll("div.mdq-wrap");a.forEach(t=>{t.remove()}),(""==mdq.config.parent?document.body:document.getElementById(mdq.config.parent)).appendChild(r);let s=document.querySelectorAll("div.mdq-question input[data-hash]");s.forEach(e=>{e.addEventListener("keyup",t=>{e.classList.remove("correct","incorrect"),document.querySelector('button[data-hash="'+e.getAttribute("data-hash")+'"]').disabled=!1})});let i=document.querySelectorAll("div.mdq-question select[data-hash]");i.forEach(e=>{e.value=-1,e.addEventListener("change",t=>{e.classList.remove("correct","incorrect"),document.querySelector('button[data-hash="'+e.getAttribute("data-hash")+'"]').disabled=!1})});let n=document.querySelectorAll("pre code.language-mermaid");n.forEach(t=>{t.parentElement;let e=document.createElement("div");e.classList.add("mermaid"),e.innerHTML=t.innerHTML,t.parentElement.replaceChild(e,t)}),"undefined"!=typeof MathJax&&MathJax.typeset&&MathJax.typeset(),Prism.highlightAll&&Prism.highlightAll(mdq.config.parent?document.getElementById(mdq.config.parent):document)},questionElement:function(r){var e=document.createElement("div");e.setAttribute("class","mdq-question"),e.setAttribute("data-hash",r.hash),e.setAttribute("id",r.hash);let t=[];r.file&&t.push("file: "+r.file),r.frontMatter.title&&t.push("title: "+r.frontMatter.title);var a=document.createComment(t.join(", "));e.appendChild(a);let s=document.createElement("div");s.setAttribute("class","md-question-body"),s.innerHTML=mdq.formatQuestion(r),e.appendChild(s);let i="";if(mdq.isMultipleChoice(r)){let t=mdqQuestions.mcHTML(r);t.addEventListener("click",t=>{mdqQuestions.highlightMC(t)}),e.appendChild(t),i="MC"}else mdq.isTrueFalse(r)&&(a=mdqQuestions.tfHTML(r),e.appendChild(a),i="TF");let n=document.createElement("div");n.setAttribute("class","mdq-buttons");let d=document.createElement("button");if(mdq.isBootstrap()&&d.classList.add("btn","btn-primary"),d.setAttribute("data-type",i),d.setAttribute("data-hash",r.hash),d.setAttribute("disabled",!0),d.addEventListener("click",t=>{mdqQuestions.checkQuestion(t.currentTarget.getAttribute("data-hash"))}),d.innerHTML=mdq.config.lang.check+"...",n.appendChild(d),void 0!==r.sections.explanation){let t=document.createElement("button");t.setAttribute("disabled",!0),t.setAttribute("data-help",1),t.setAttribute("data-hash",r.hash),mdq.isBootstrap()&&t.classList.add("btn","btn-secondary"),t.addEventListener("click",t=>{let e=document.querySelector('div.mdq-explanation[data-hash="'+r.hash+'"]');e&&(e.style.display="block")}),t.innerHTML=this.config.lang.help+"...",n.appendChild(t)}if(e.appendChild(n),void 0!==r.sections.explanation){let t=document.createElement("div");t.setAttribute("class","mdq-explanation"),t.setAttribute("data-hash",r.hash),t.style.display="none",t.innerHTML=marked(r.sections.explanation),e.appendChild(t)}return e},formatQuestion:function(t){let e=marked(t.markdown);return mdq.isFIB(t)&&(e=mdqQuestions.parseFields(e,t)),e},loadFiles:async function(t){for(const r of this.allQuestions){let t=await fetch(r);var e;if(200<=t.status&&t.status<400&&(e=await t.text(),this.loadedQuestions.push(this.fileInfo(e,r))),this.loadedQuestions.length>=this.config.count)break}},fileInfo:function(t,e){t=t.trim(),mdq.config.stripRaw&&(t=t.replace(/{%\s*?(end)?raw\s*?%}/gs,"").trim());let r={};r.file=e,r.rawContent=t,r.hash=Math.random().toString(36).slice(-10),r.frontMatter={};let a=t.match(/^---\s*?(.*?)---/s);a&&(r.frontMatter=this.parseFrontMatter(a[1].trim()));let s=(t=t.replace(/^---\s*?(.*?)---/s,"").trim()).split(/---[\t ]*?([A-Za-z ]+)/g);r.markdown=s.shift().trim(),r.sections={};for(let t=0;t<s.length-1;t+=2)r.sections[this.toCamelCase(s[t].trim())]=s[t+1].trim();return r},parseFrontMatter:function(t){let r={},e=t.split(/\n\r?/);return e.forEach(t=>{let e=(t=t.trim()).split(/\s*?:\s*?/);2==e.length&&(r[this.toCamelCase(e[0].trim())]=e[1].trim())}),void 0===r.answer&&void 0!==r.ans&&(r.answer=r.ans),r},getParts:function(t){return{frontMatter:{title:"",type:"",answer:""},body:"",explanation:""}},toCamelCase:function(t){return t.replace(/\s(.)/g,function(t){return t.toUpperCase()}).replace(/\s/g,"").replace(/^(.)/,function(t){return t.toLowerCase()})},isMultipleChoice:function(t){let e=t.frontMatter.type??"";return e=e.trim(),!("mc"!=e.toLowerCase()&&!e.match(/^mult.*?/i))||""==e&&void 0!==t.sections.answers},isFIB:function(t){let e=t.frontMatter.type??"";return e=e.trim(),!("fib"!=e.toLowerCase()&&!e.match(/^fill.*?/i))},isTrueFalse:function(t){let e=t.frontMatter.type??"";return!!e.match(/^t.*?/i)},shuffle:function(e){for(let t=e.length-1;0<t;t--){var r=Math.floor(Math.random()*(t+1)),a=e[t];e[t]=e[r],e[r]=a}return e},isBootstrap:function(){return"bootstrap5"==mdq.config.theme},parentElement:function(){return mdq.config.parent?document.getElementById(mdq.config.parent):document.body},decodeEntities:function(t){let e=document.createElement("textarea");return e.innerHTML=t,e.value},isTruthy:function(t){return 1==(t="string"==typeof(t|=!1)?t.toLowerCase():t)||"true"==t||"1"==t},hasGroups:function(){return"object"==typeof mdq.config.questions&&!Array.isArray(mdq.config.questions)},groupList:function(){return mdq.hasGroups()?Object.keys(mdq.config.questions):[]}},mdqCSS={cssContents:`div.mdq-wrap .mdq-question-groups{margin-top:16px;margin-bottom:8px}div.mdq-wrap .mdq-question-groups label{padding-right:16px;margin-bottom:8px}div.mdq-wrap .mdq-question-groups input[type="checkbox"]{margin-right:8px}div.mdq-wrap .mdq-question{margin-bottom:48px;padding-top:16px;border-top:1px solid silver}div.mdq-wrap .mdq-question:first-child{border-top:none}div.mdq-wrap .mdq-question input.correct,div.mdq-wrap .mdq-question select.correct{background-color:#ccffcc !important}div.mdq-wrap .mdq-question input.incorrect,div.mdq-wrap .mdq-question select.incorrect{background-color:#ffc2b3 !important}div.mdq-wrap .mdq-mc-grid{display:grid;grid-template-columns:min-content 1fr;cursor:pointer;padding-top:16px}div.mdq-wrap .mdq-mc-grid>div{padding-right:16px}div.mdq-wrap .mdq-mc-grid>div.sel{background:#eee}div.mdq-wrap .mdq-mc-grid>div.correct{background:#ccffcc}div.mdq-wrap .mdq-mc-grid>div.incorrect{background:#ffc2b3}div.mdq-wrap .mdq-buttons button{margin-right:16px;margin-top:16px}div.mdq-wrap .mdq-explanation{margin-top:16px}div.mdq-wrap .form-select,div.mdq-wrap .form-control{width:auto;display:inline !important}div.mdq-wrap .mdq-tf-result{margin-left:16px}div.mdq-wrap .mdq-tf-result.correct{color:green}div.mdq-wrap .mdq-tf-result.incorrect{color:red}div.mdq-wrap .mdq-credit{padding-top:32px;padding-bottom:16px}div.mdq-wrap .mdq-credit a{text-decoration:none}div.mdq-wrap .mdq-credit a:hover{text-decoration:underline}div.mdq-wrap .mdq-reload{margin-top:16px;margin-bottom:16px}
`},mdqQuestions={mcHTML:function(s){let t=s.sections.answers.split(/---[\t ]*\r?\n/),i=s.frontMatter.answer??"1";if(i.match(/^[A-Za-z]{1}$/))i="ABCDEFGHIJKLMNOPQRSTUVWXYZ".indexOf(i.toUpperCase())+1;else if(!i.match(/^\d+?$/))return void console.error("Could not determine correct answer for question");let n=document.createElement("div");n.setAttribute("class","mdq-mc-grid"),n.setAttribute("data-hash",s.hash);let d=[],o=1;t.forEach(t=>{let e=document.createElement("div");e.setAttribute("data-row",o),e.setAttribute("data-hash",s.hash),e.setAttribute("data-col",0);let r=document.createElement("input");r.type="radio",r.name="ans-"+s.hash,r.setAttribute("data-row",o),r.setAttribute("data-hash",s.hash),r.setAttribute("data-c",o==i?1:0),e.appendChild(r),n.appendChild(e);let a=document.createElement("div");a.setAttribute("data-row",o),a.setAttribute("data-hash",s.hash),a.innerHTML=marked(t),d.push([e,a]),o++});let e=s.frontMatter.shuffle;return void 0!==e&&!e.match(/^t.*/i)&&1!=e||(d=mdq.shuffle(d)),d.forEach(t=>{n.appendChild(t[0]),n.appendChild(t[1])}),n},tfHTML:function(e){let t=e.frontMatter.answer??"t";t=t.match(/^f.*/i)?"F":"T";let r=document.createElement("div"),a=document.createElement("select");a.setAttribute("data-hash",e.hash),a.setAttribute("data-c",t),"bootstrap5"==mdq.config.theme&&a.classList.add("form-select");let s=document.createElement("option");s.innerHTML=mdq.config.lang.true,s.value="T",a.appendChild(s);let i=document.createElement("option");i.innerHTML=mdq.config.lang.false,i.value="F",a.appendChild(i),a.value=-1,a.addEventListener("change",t=>{document.querySelector('button[data-hash="'+e.hash+'"][data-type="TF"]').disabled=!1,document.querySelector('span[data-result][data-hash="'+e.hash+'"]').innerHTML=""}),r.appendChild(a);let n=document.createElement("span");return n.classList.add("mdq-tf-result"),n.setAttribute("data-hash",e.hash),n.setAttribute("data-result",1),n.innerHTML="",r.appendChild(n),r},highlightMC:function(t){let e=t.target.closest("[data-row]");var r=e.getAttribute("data-hash"),t=e.getAttribute("data-row");document.querySelector('[data-row="'+t+'"][data-hash="'+r+'"] > input').checked=!0;let a=document.querySelectorAll('.mdq-mc-grid[data-hash="'+r+'"] > div');a.forEach(t=>{t.classList.remove("sel","correct","incorrect")});let s=document.querySelectorAll('.mdq-mc-grid > div[data-row="'+t+'"][data-hash="'+r+'"]');s.forEach(t=>{t.classList.add("sel")}),document.querySelector('button[data-hash="'+r+'"]').disabled=!1},checkQuestion:function(t){var e=mdqQuestions.getQuestion(t);if(!1!==e){if(mdq.isMultipleChoice(e))mdqQuestions.checkMCQuestion(e);else if(mdq.isTrueFalse(e))mdqQuestions.checkTFQuestion(e);else{if(!mdq.isFIB(e))return void console.error("Only MC/TF/FIB checking is implemented for now");mdqQuestions.checkFIBQuestion(e)}let t=document.querySelector('button[data-help][data-hash="'+e.hash+'"]');t&&(t.disabled=!1)}else console.error("Question "+t+" not found")},checkFIBQuestion:function(t){let e=document.querySelectorAll('div.mdq-question[data-hash="'+t.hash+'"] input');e.forEach(a=>{if(a.classList.remove("correct","incorrect"),""!=a.value){var t=JSON.parse(a.getAttribute("data-opts"));let r=!1;if(mdq.isTruthy(t.contains))r=mdq.isTruthy(t.caseSensitive)?-1<a.value.indexOf(a.getAttribute("data-c")):-1<a.value.toLowerCase().indexOf(a.getAttribute("data-c").toLowerCase());else if(mdq.isTruthy(t.regex)){let t=a.getAttribute("data-c"),e="";var s=t.match(/\/([gimy]*)$/);s&&(e=s[1]),t=t.replace(/^\//,"").replace(/\/[gimy]*$/,"");s=new RegExp(t,e);r=!!a.value.match(s)}else r=mdq.isTruthy(t.caseSensitive)?a.value==mdq.decodeEntities(a.getAttribute("data-c")):a.value.toLowerCase()==mdq.decodeEntities(a.getAttribute("data-c")).toLowerCase();r?a.classList.add("correct"):a.classList.add("incorrect")}});let r=document.querySelectorAll('div.mdq-question[data-hash="'+t.hash+'"] select');r.forEach(t=>{t.classList.remove("correct","incorrect");var e=t.options[t.selectedIndex];e&&("1"==e.getAttribute("data-c")?t.classList.add("correct"):t.classList.add("incorrect"))})},checkTFQuestion:function(t){let e=document.querySelector('span[data-result][data-hash="'+t.hash+'"]');e.classList.remove("correct","incorrect"),e.innerHTML="";let r=document.querySelector('select[data-hash="'+t.hash+'"]');r.value==r.getAttribute("data-c")?(e.classList.add("correct"),e.innerHTML=mdq.config.lang.correct):(e.classList.add("incorrect"),e.innerHTML=mdq.config.lang.incorrect)},checkMCQuestion:function(t){let e=document.querySelectorAll('div.mdq-mc-grid[data-hash="'+t.hash+'"] > div');e.forEach(t=>{t.classList.remove("sel","correct","incorrect")});let r=document.querySelector("input[name=ans-"+t.hash+"]:checked"),a=1==r.getAttribute("data-c"),s=document.querySelectorAll('div.mdq-mc-grid[data-hash="'+r.getAttribute("data-hash")+'"] > div[data-row="'+r.getAttribute("data-row")+'"][data-hash="'+r.getAttribute("data-hash")+'"]');s.forEach(t=>{t.classList.add(a?"correct":"incorrect")})},getQuestion:function(t){for(const e of mdq.loadedQuestions)if(e.hash==t)return e;return!1},parseFields:function(t,n){return t=(t=t.replace(/___\((.*?)\)\[(.*?)\]/g,(t,e,r)=>{r=mdqQuestions.fibParseOptions(r);let a=document.createElement("input");return a.setAttribute("data-hash",n.hash),a.setAttribute("data-c",e),"bootstrap5"==mdq.config.theme&&a.classList.add("form-control"),void 0!==r.width&&(a.style.width=r.width),a.setAttribute("data-opts",JSON.stringify(r)),a.outerHTML})).replace(/___{(.*?)}\[(.*?)]/g,(t,e,r)=>{r=mdqQuestions.fibParseOptions(r);let a=document.createElement("select");a.setAttribute("data-hash",n.hash),"bootstrap5"==mdq.config.theme&&a.classList.add("form-select");let s=e.split(/\s*?\|\s*?/),i=[];return s.forEach(t=>{var e=!!t.match(/^\+:/);t=t.replace(/^(\+|\-):/,"");let r=document.createElement("option");r.setAttribute("data-c",e?1:0),r.value=t,r.innerHTML=t,i.push(r)}),r.shuffle&&("1"==r.shuffle||r.shuffle.match(/^(t|y)/i))&&(i=mdq.shuffle(i)),i.forEach(t=>{a.appendChild(t)}),a.outerHTML})},fibParseOptions:function(t){let e=t.split(/\s*?,\s*?/),r={};return e.forEach(t=>{let e=t.split(/\s*?:\s*?/);void 0!==e[0]&&void 0!==e[1]&&(r[mdq.toCamelCase(e[0].trim())]=e[1].trim())}),r},needsMermaid:function(t){return!!t.rawContent.match(/```mermaid/s)},needsMathJax:function(t){return!(!t.rawContent.match(/\$\$(.*?)\$\$/s)&&!t.rawContent.match(/\\\(.*?\)\\/s))},needsPrism:function(t){let e=t.rawContent.match(/```([A-Za-z0-9]+)/gs),r=!1;return!!e&&(e.forEach(t=>{"```mermaid"!=t&&(r=!0)}),r)}};